# Task Agnostic Steps (TAS) for Runtime System

This document outlines the fundamental, language-agnostic steps performed by the runtime system.

## 1. System Initialization and Configuration

*   **Load System Configuration**: Read and parse configuration settings from a defined source (e.g., YAML file).
*   **Discover and Load Agents**: Identify and load agent definitions from a specified location (e.g., directory of files).
*   **Discover and Load Prompts**: Identify and load system prompts associated with agents from a specified location (e.g., directory of text files).
*   **Instantiate Agents**: Create instances of agents based on their specifications, including their name, role, goal, associated LLM model, and system prompt.
*   **Initialize LLM Clients**: Set up connections or clients for Large Language Models (LLMs) based on configuration.
*   **Set Up Logging**: Configure the application's logging mechanism, including format, level, and output destinations (console, file).

## 2. Workflow Planning

*   **Receive High-Level Goal**: Accept the overarching objective for the workflow.
*   **Describe Available Agents and Roles**: Provide a description of the agents and their capabilities to the planning agent.
*   **Generate Plan**: Use an LLM to break down the high-level goal into a sequence of structured tasks, defining roles, agents, and dependencies.
*   **Validate Plan**: Ensure the generated plan is valid and adheres to the defined structure (e.g., Pydantic schema).
*   **Record Initial Plan**: Store the generated plan as an artifact.

## 3. Workflow Execution

*   **Initialize Session**: Create and manage a session for the entire workflow, including session ID and artifact storage directory.
*   **Initialize Execution Context**: Set up the context for a specific round and step of the workflow, including the plan, current step, and available artifacts.
*   **Record Initial Artifacts**: Store any initial input files or data provided at the start of the workflow.
*   **Iterate Through Workflow Rounds**: Execute the workflow for a specified number of rounds.
*   **Iterate Through Tasks in Plan**: Process each task sequentially within a round based on the plan.
*   **Identify and Select Agent**: Determine the appropriate agent responsible for executing the current task.
*   **Prepare Task Prompt**: Construct the prompt for the agent, including the overall goal, specific task description, agent's role and goal, and relevant previous artifacts.
*   **Record Task Prompt**: Store the generated prompt as an artifact.
*   **Execute Task**: Delegate the task execution to the selected agent.
*   **Agent Task Execution**: The agent processes the prompt, potentially interacting with an LLM.
*   **LLM Interaction**: Send the prompt to an LLM and receive a response.
*   **Parse LLM Response**: Process the LLM's output, which may be structured (e.g., JSON) or plain text.
*   **Handle Agent Output**: Parse the agent's output, extracting the main message, any generated artifacts (files), and potential team updates (like new prompts).
*   **Record Task Result**: Store the agent's output and any generated artifacts.
*   **Update Agent Prompts**: If the agent's output includes updated system prompts, apply these changes to the relevant agents.
*   **Advance Execution Context**: Move to the next task or step in the plan.
*   **Handle Task Dependencies**: Ensure tasks are executed only after their prerequisites are met (implicitly handled by sequential plan execution).
*   **Manage Artifacts**: Store and retrieve artifacts generated by agents throughout the workflow.

## 4. Agent Communication and State Management

*   **Agent Lifecycle Management**: Define and manage the lifecycle of agents (initialization, task execution).
*   **Contextual Information Sharing**: Provide agents with the necessary context (plan, previous artifacts, goal) for task execution.
*   **Artifact Storage and Retrieval**: Save and load artifacts generated by agents throughout the workflow.
*   **Session Management**: Maintain the state and data for an entire workflow session.
*   **System Prompt Updates**: Allow agents to update their own or other agents' system prompts dynamically.

## 5. LLM Interaction Abstraction

*   **Abstract LLM Interface**: Define a common interface for interacting with different LLM providers.
*   **LLM Model Selection**: Allow selection of specific LLM models based on configuration.
*   **Content Generation**: Utilize LLMs to generate text content based on provided prompts and instructions.
*   **Response Formatting**: Handle LLM responses, including parsing JSON or other structured formats, and validating against schemas.

## 6. Error Handling and Resilience

*   **Exception Handling**: Catch and log errors during configuration loading, agent instantiation, plan generation, and task execution.
*   **LLM Call Retries**: Implement retry mechanisms for LLM interactions in case of transient errors.
*   **Fallback Mechanisms**: Provide fallback agents or behaviors when a specific agent cannot be found or fails.
